generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}
model User {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  email String @unique
  name String @unique
  password String
  cpf String @unique
  balance Int @default(0)
  pin String?
  pixKeys PixKey[]
  creditCard CreditCard?  
  sentTransactions     Transaction[] @relation("SentTransactions")
  receivedTransactions Transaction[] @relation("ReceivedTransactions")
  savings Saving[]
  statements Statement[]

}
model Statement {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])
  month Int
  year Int
  entryValues Int @default(0)
  exitValues Int @default(0)
  totalIncome Int @default(0)
  totalExpense Int @default(0)
}
model Saving {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])
  goalName String
  targetAmount Int?
  currentAmount Int @default(0)
}
model Transaction {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  user          User     @relation("SentTransactions", fields: [userId], references: [id])
  userId        String @db.ObjectId
  destinationUser User    @relation("ReceivedTransactions", fields: [destinationId], references: [id])
  destinationId     String @db.ObjectId
  method String 
  amount Int
  date DateTime @default(now())
  description String?
  createdAt DateTime @default(now())
}

model CreditCard {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId @unique
  user User @relation(fields: [userId], references: [id])

  number String @unique
  cvv String
  expirationDate DateTime
  
  invoiceDueDay Int
  invoiceClosingDay Int

  invoiceDueDate DateTime
  invoiceClosingDate DateTime

  creditLimit Int @default(600)
  currentLimit Int @default(600)

  invoices Invoice[]
}

model Invoice {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  creditCardId String @db.ObjectId
  creditCard CreditCard @relation(fields: [creditCardId], references: [id])

  referenceDate DateTime

  totalAmount Int
  paidAmount Int @default(0)

  isPaid Boolean @default(false)
}


model PixKey{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId
  user User @relation(fields: [userId], references: [id])
  key String? @unique
  type String
}